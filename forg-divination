<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>æ•¸å­—èµ·å¦å°å·¥å…·</title>
  <style>
    body { font-family: sans-serif; padding: 2rem; max-width: 600px; margin: auto; background: #f6f6f6; }
    h1 { font-size: 1.5rem; text-align: center; margin-bottom: 1rem; }
    input, button { padding: 0.5rem; margin: 0.25rem 0; width: 100%; }
    pre { background: white; padding: 1rem; border-radius: 0.5rem; }
  </style>
</head>
<body>
  <h1>ğŸ”® æ•¸å­—èµ·å¦å°å·¥å…·</h1>
  <label>ä¸‹å¦æ•¸å­—ï¼š</label>
  <input type="number" id="bottomNum" placeholder="è«‹è¼¸å…¥ä¸‹å¦æ•¸å­—">

  <label>ä¸Šå¦æ•¸å­—ï¼š</label>
  <input type="number" id="topNum" placeholder="è«‹è¼¸å…¥ä¸Šå¦æ•¸å­—">

  <label>å‹•çˆ»ï¼ˆ1~6ï¼Œå¯é¸ï¼‰ï¼š</label>
  <input type="number" id="movingYao" placeholder="ä¸è¼¸å…¥å‰‡ä¸è®Šå¦">

  <button onclick="generateHexagram()">è§£å¦ï¼</button>

  <pre id="result"></pre>

  <script>
    const trigramMap = ["å¤ï¼ˆåœ°ï¼‰", "ä¹¾ï¼ˆå¤©ï¼‰", "å…Œï¼ˆæ¾¤ï¼‰", "é›¢ï¼ˆç«ï¼‰", "éœ‡ï¼ˆé›·ï¼‰", "å·½ï¼ˆé¢¨ï¼‰", "åï¼ˆæ°´ï¼‰", "è‰®ï¼ˆå±±ï¼‰", "å¤ï¼ˆåœ°ï¼‰"];
    const trigramToBinary = {
      "ä¹¾ï¼ˆå¤©ï¼‰": [1, 1, 1], "å…Œï¼ˆæ¾¤ï¼‰": [0, 1, 1], "é›¢ï¼ˆç«ï¼‰": [1, 0, 1],
      "éœ‡ï¼ˆé›·ï¼‰": [0, 0, 1], "å·½ï¼ˆé¢¨ï¼‰": [1, 1, 0], "åï¼ˆæ°´ï¼‰": [0, 1, 0],
      "è‰®ï¼ˆå±±ï¼‰": [1, 0, 0], "å¤ï¼ˆåœ°ï¼‰": [0, 0, 0]
    };

    const binaryToTrigram = {};
    for (let key in trigramToBinary) binaryToTrigram[trigramToBinary[key].join()] = key;

    function numberToTrigram(n) {
      return trigramMap[n % 8];
    }

    function buildHexagram(bottom, top) {
      const bottomT = numberToTrigram(bottom);
      const topT = numberToTrigram(top);
      const bin = [...trigramToBinary[bottomT], ...trigramToBinary[topT]];
      return { bottomT, topT, bin };
    }

    function changeYao(bin, yao) {
      const newBin = bin.slice();
      const idx = 6 - yao;
      if (idx >= 0 && idx < 6) newBin[idx] = 1 - newBin[idx];
      return newBin;
    }

    function getTrigramName(bin3) {
      return binaryToTrigram[bin3.join()] || "æœªçŸ¥";
    }

    function displayHex(bin) {
      return bin.slice().reverse().map((v, i) => `ç¬¬${6 - i}çˆ»: ${v === 1 ? "â€” â€”" : "â€”â€”â€”"}`).join("\n");
    }

    function generateHexagram() {
      const b = parseInt(document.getElementById("bottomNum").value);
      const t = parseInt(document.getElementById("topNum").value);
      const m = parseInt(document.getElementById("movingYao").value);
      if (isNaN(b) || isNaN(t)) {
        alert("è«‹è¼¸å…¥ä¸Šä¸‹å¦æ•¸å­—");
        return;
      }

      const hex = buildHexagram(b, t);
      const base = `ã€æœ¬å¦ã€‘\n${displayHex(hex.bin)}\nä¸Šå¦ï¼š${hex.topT}ã€€ä¸‹å¦ï¼š${hex.bottomT}`;

      let result = base;

      if (!isNaN(m) && m >= 1 && m <= 6) {
        const newBin = changeYao(hex.bin, m);
        const newTop = getTrigramName(newBin.slice(3));
        const newBottom = getTrigramName(newBin.slice(0, 3));
        const changed = `\n\nã€è®Šå¦ã€‘\n${displayHex(newBin)}\nä¸Šå¦ï¼š${newTop}ã€€ä¸‹å¦ï¼š${newBottom}`;
        result += changed;
      }

      document.getElementById("result").textContent = result;
    }
  </script>
</body>
</html>
